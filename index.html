<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyond Acads Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a better look */
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        #chat-messages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <!-- Chatbot container -->
    <div class="w-full max-w-lg mx-auto bg-white rounded-2xl shadow-2xl flex flex-col h-[80vh] max-h-[700px]">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-2xl flex items-center justify-between shadow-md">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mr-4 overflow-hidden">
                    <img src="https://ik.imagekit.io/97vbpbrok/WhatsApp%20Image%202025-08-17%20at%2004.17.34_f48ad4a5.jpg?updatedAt=1755775633765" alt="Profile Picture" class="w-full h-full object-cover">
                </div>
                <div>
                    <h1 class="text-xl font-bold">Beyond Acads</h1>
                    <p class="text-sm opacity-80">Online</p>
                </div>
            </div>
        </div>

        <!-- Messages container -->
        <div id="chat-messages" class="flex-1 p-6 overflow-y-auto">
            <!-- Initial bot message -->
            <div class="flex items-start gap-3 mb-4">
                <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden">
                   <img src="https://ik.imagekit.io/97vbpbrok/WhatsApp%20Image%202025-08-17%20at%2004.17.34_f48ad4a5.jpg?updatedAt=1755775633765" alt="Bot Avatar" class="w-full h-full object-cover">
                </div>
                <div class="bg-gray-200 p-3 rounded-lg max-w-md">
                    <p class="text-sm text-gray-800">üëã Welcome to Beyond Acads!</p>
                    <p class="text-sm text-gray-800 mt-2">Looking for the latest govt. exams requiring CA/CMA? I‚Äôm here to guide you with eligibility, posts, pay scales, deadlines, and more.</p>
                    <p class="text-sm text-gray-800 mt-2">How can I help you today?</p>
                </div>
            </div>
        </div>

        <!-- Input form -->
        <div class="p-4 border-t border-gray-200 bg-white rounded-b-2xl">
            <form id="chat-form" class="flex items-center">
                <input type="text" id="user-input" placeholder="Type your message..." class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                <button type="submit" class="ml-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7" />
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');

        // Data from the Google Sheet, converted to JSON format. This is the chatbot's knowledge base.
        const examData = [
            { "Organisation": "THDC India Limited", "Post Name": "Accounts Officer", "Qualification": "CA/CMA", "Experience": "1 Year", "No of Post": 25, "Last Date": "08-Jul-24", "Link": "https://thdc.co.in/sites/default/files/Advt_for_E2_Grade_Post_Code_11_to_20.pdf" },
            { "Organisation": "RITES Ltd", "Post Name": "Assistant Manager (Finance)", "Qualification": "CA/CMA", "Experience": "2 Years", "No of Post": 10, "Last Date": "04-Jul-24", "Link": "https://www.rites.com/Upload/Career/24_24_AM_Fin_vac_200624.pdf" },
            { "Organisation": "Gujarat Metro Rail Corporation (GMRC) Limited", "Post Name": "Manager (Finance & Accounts)", "Qualification": "CA/CMA", "Experience": "9 Years", "No of Post": 2, "Last Date": "26-Jun-24", "Link": "https://www.gujaratmetrorail.com/wp-content/uploads/2024/05/GMRC_Recruitment-Notification-for-various-posts-for-F-A-and-HR-Dept-Final-24.05.2024.pdf" },
            { "Organisation": "Grid Controller of India Limited (Grid-India)", "Post Name": "Sr. Accounts Officer", "Qualification": "CA/CMA", "Experience": "3 Years", "No of Post": 15, "Last Date": "30-Jun-24", "Link": "https://grid-india.in/wp-content/uploads/2024/06/Detailed-Advt.-for-recruitment-of-experienced-professionals-in-Grid-India.pdf" },
            { "Organisation": "Indian Oil Corporation Limited (IOCL)", "Post Name": "Finance Executive", "Qualification": "CA/CMA", "Experience": "3 Years", "No of Post": 6, "Last Date": "02-Jul-24", "Link": "https://iocl.com/admin/img/Upload/Private/5_DetailedadvertisementforemploymentofFinanceexecutivesoncontractbasis.pdf" },
            { "Organisation": "Rail Vikas Nigam Limited (RVNL)", "Post Name": "Manager (Finance)", "Qualification": "CA/CMA", "Experience": "PSU Employee", "No of Post": 4, "Last Date": "10-Jul-24", "Link": "https://rvnl.org/uploads/opportunity/opportunity_doc_qrG1v.pdf" },
            { "Organisation": "Rail Vikas Nigam Limited (RVNL)", "Post Name": "Dy. Manager (Finance)", "Qualification": "CA/CMA", "Experience": "PSU Employee", "No of Post": 4, "Last Date": "10-Jul-24", "Link": "https://rvnl.org/uploads/opportunity/opportunity_doc_qrG1v.pdf" },
            { "Organisation": "Rail Vikas Nigam Limited (RVNL)", "Post Name": "Assistant Manager (Finance)", "Qualification": "CA/CMA", "Experience": "PSU Employee", "No of Post": 10, "Last Date": "10-Jul-24", "Link": "https://rvnl.org/uploads/opportunity/opportunity_doc_qrG1v.pdf" }
        ];

        // This will hold the conversation history, primed with the chatbot's persona and knowledge base.
        let chatHistory = [
            {
                role: "user",
                parts: [{ text: `
                    # Objective:
                    You are an expert career and exam guidance assistant. Your role is to help aspirants stay updated on upcoming Government exams that require CA and CMA qualifications. 
                    
                    # Knowledge Source:
                    You MUST answer questions based ONLY on the following JSON data. Do not use any other knowledge.
                    \`\`\`json
                    ${JSON.stringify(examData)}
                    \`\`\`

                    # Style:
                    - Be friendly, professional, and encouraging.
                    - Use bullet points and short paragraphs.
                    - Highlight key facts with **bold**.
                    - Use relevant emojis (üìå, ‚è∞, üíº, üìù) to make it engaging.

                    # Rules:
                    1. Always use the provided JSON data as your single source of truth. Do not guess or infer information not present in the data.
                    2. If the data for a specific field is missing or unclear in the JSON, explicitly mention that the detail is not available.
                    3. If asked about something outside the scope of the provided exam data (e.g., other exams, general advice), politely decline and redirect to exam-related support.
                    4. Keep answers short and easy to understand.
                    5. At the end of relevant answers, include the following message: "We also help participants prepare for these exams. This initiative is run by two professionals (CMAs). For more information you can join the community on Whatsapp (http://chat.whatsapp.com/CHZttXz86jW4hZkLNzDSeb?mode=ac_t) and Telegram (http://t.me/BeyondAcadsGovtJob)"
                `}]
            },
            {
                role: "model",
                parts: [{ text: "Understood. I am the Beyond Acads assistant. I will act as an expert career and exam guidance counselor, answering questions based *only* on the provided data about CA/CMA government exams. I am ready to assist." }]
            }
        ];

        // Function to add a message to the chat display
        function addMessage(sender, message) {
            const messageElement = document.createElement('div');
            let messageHtml = '';

            if (sender === 'user') {
                messageHtml = `
                    <div class="flex items-start gap-3 mb-4 justify-end">
                        <div class="bg-blue-500 text-white p-3 rounded-lg max-w-xs">
                            <p class="text-sm">${message}</p>
                        </div>
                        <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </div>
                `;
            } else {
                // The bot's response will be rendered by a library that supports Markdown.
                // For now, we'll just display it. A simple replacement for **text** can be done.
                const formattedMessage = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                messageHtml = `
                    <div class="flex items-start gap-3 mb-4">
                        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden">
                            <img src="https://ik.imagekit.io/97vbpbrok/WhatsApp%20Image%202025-08-17%20at%2004.17.34_f48ad4a5.jpg?updatedAt=1755775633765" alt="Bot Avatar" class="w-full h-full object-cover">
                        </div>
                        <div class="bg-gray-200 p-3 rounded-lg max-w-md">
                            <p class="text-sm text-gray-800">${formattedMessage}</p>
                        </div>
                    </div>
                `;
            }
            messageElement.innerHTML = messageHtml;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to show a loading indicator
        function showLoadingIndicator() {
            const loadingElement = document.createElement('div');
            loadingElement.id = 'loading-indicator';
            loadingElement.innerHTML = `
                <div class="flex items-start gap-3 mb-4">
                    <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden">
                       <img src="https://ik.imagekit.io/97vbpbrok/WhatsApp%20Image%202025-08-17%20at%2004.17.34_f48ad4a5.jpg?updatedAt=1755775633765" alt="Bot Avatar" class="w-full h-full object-cover">
                    </div>
                    <div class="bg-gray-200 p-3 rounded-lg max-w-xs">
                        <div class="flex items-center justify-center space-x-1">
                            <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse"></div>
                            <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                            <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                        </div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(loadingElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to remove loading indicator
        function removeLoadingIndicator() {
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) {
                loadingIndicator.remove();
            }
        }

        // Handle form submission
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = userInput.value.trim();
            if (!message) return;

            addMessage('user', message);
            userInput.value = '';
            showLoadingIndicator();

            // Add user message to history
            chatHistory.push({ role: "user", parts: [{ text: message }] });

            try {
                // Call the Gemini API
                const apiKey = "AIzaSyAQzezVKjdXbMElqFTagflkAUU0EhOQagk"; // IMPORTANT: PASTE YOUR API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const payload = { contents: chatHistory };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                removeLoadingIndicator();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    const botResponse = result.candidates[0].content.parts[0].text;
                    addMessage('bot', botResponse);
                    // Add bot response to history
                    chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
                } else {
                    addMessage('bot', "I'm sorry, I couldn't generate a response. Please try again.");
                }

            } catch (error) {
                console.error('Error calling Gemini API:', error);
                removeLoadingIndicator();
                addMessage('bot', "I'm having trouble connecting. Please check your connection or try again later.");
            }
        });
    </script>
</body>
</html>
