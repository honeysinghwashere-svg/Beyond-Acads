<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyond Acads Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a better look */
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        #chat-messages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <!-- Chatbot container -->
    <div class="w-full max-w-lg mx-auto bg-white rounded-2xl shadow-2xl flex flex-col h-[80vh] max-h-[700px]">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-2xl flex items-center justify-between shadow-md">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7s-8-3.134-8-7c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.293 5.707a1 1 0 010 1.414 5 5 0 01-7.072 0 1 1 0 011.414-1.414 3 3 0 004.244 0 1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold">Beyond Acads</h1>
                    <p class="text-sm opacity-80">Online</p>
                </div>
            </div>
        </div>

        <!-- Messages container -->
        <div id="chat-messages" class="flex-1 p-6 overflow-y-auto">
            <!-- Initial bot message -->
            <div class="flex items-start gap-3 mb-4">
                <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                   <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7s-8-3.134-8-7c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.293 5.707a1 1 0 010 1.414 5 5 0 01-7.072 0 1 1 0 011.414-1.414 3 3 0 004.244 0 1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="bg-gray-200 p-3 rounded-lg max-w-md">
                    <p class="text-sm text-gray-800">üëã Welcome to Beyond Acads!</p>
                    <p class="text-sm text-gray-800 mt-2">Looking for the latest govt. exams requiring CA/CMA? I‚Äôm here to guide you with eligibility, posts, pay scales, deadlines, and more.</p>
                    <p class="text-sm text-gray-800 mt-2">How can I help you today?</p>
                </div>
            </div>
        </div>

        <!-- Input form -->
        <div class="p-4 border-t border-gray-200 bg-white rounded-b-2xl">
            <form id="chat-form" class="flex items-center">
                <input type="text" id="user-input" placeholder="Type your message..." class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                <button type="submit" class="ml-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7" />
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');

        // This will hold the conversation history, primed with the chatbot's persona.
        let chatHistory = [
            {
                role: "user",
                parts: [{ text: `
                    # Objective:
                    You are an expert career and exam guidance assistant. Your role is to help aspirants stay updated on upcoming Government exams that require CA and CMA qualifications. Always provide clear information about:
                    - Organisation name
                    - Post/role details
                    - Eligibility (CA, CMA, MBA, etc.)
                    - Pay scale / CTC
                    - Work experience required
                    - Number of vacancies (category-wise, if available)
                    - Application deadlines
                    - Official application link

                    # Style:
                    - Be friendly, professional, and encouraging.
                    - Use bullet points and short paragraphs.
                    - Highlight key facts with **bold**.
                    - Use relevant emojis (üìå, ‚è∞, üíº, üìù) to make it engaging.

                    # Rules:
                    1. Always fetch exam details from the knowledge source provided. Do not guess.
                    2. If details are incomplete or unclear, explicitly mention what is missing.
                    3. If asked outside the scope of CA/CMA exams, politely decline and redirect to exam-related support.
                    4. Keep answers short and easy to understand.
                    5. At the end of relevant answers, include the following message: "We also help participants prepare for these exams. This initiative is run by two professionals (CMAs). For more information you can join the community on Whatsapp (http://chat.whatsapp.com/CHZttXz86jW4hZkLNzDSeb?mode=ac_t) and Telegram (http://t.me/BeyondAcadsGovtJob)"
                `}]
            },
            {
                role: "model",
                parts: [{ text: "Understood. I am the Beyond Acads assistant. I will act as an expert career and exam guidance counselor for CA/CMA government exams, following all specified objectives, styles, and rules. I am ready to assist." }]
            }
        ];

        // Function to add a message to the chat display
        function addMessage(sender, message) {
            const messageElement = document.createElement('div');
            let messageHtml = '';

            if (sender === 'user') {
                messageHtml = `
                    <div class="flex items-start gap-3 mb-4 justify-end">
                        <div class="bg-blue-500 text-white p-3 rounded-lg max-w-xs">
                            <p class="text-sm">${message}</p>
                        </div>
                        <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </div>
                `;
            } else {
                // The bot's response will be rendered by a library that supports Markdown.
                // For now, we'll just display it. A simple replacement for **text** can be done.
                const formattedMessage = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                messageHtml = `
                    <div class="flex items-start gap-3 mb-4">
                        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7s-8-3.134-8-7c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.293 5.707a1 1 0 010 1.414 5 5 0 01-7.072 0 1 1 0 011.414-1.414 3 3 0 004.244 0 1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="bg-gray-200 p-3 rounded-lg max-w-md">
                            <p class="text-sm text-gray-800">${formattedMessage}</p>
                        </div>
                    </div>
                `;
            }
            messageElement.innerHTML = messageHtml;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to show a loading indicator
        function showLoadingIndicator() {
            const loadingElement = document.createElement('div');
            loadingElement.id = 'loading-indicator';
            loadingElement.innerHTML = `
                <div class="flex items-start gap-3 mb-4">
                    <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                       <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7s-8-3.134-8-7c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.293 5.707a1 1 0 010 1.414 5 5 0 01-7.072 0 1 1 0 011.414-1.414 3 3 0 004.244 0 1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="bg-gray-200 p-3 rounded-lg max-w-xs">
                        <div class="flex items-center justify-center space-x-1">
                            <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse"></div>
                            <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                            <div class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                        </div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(loadingElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to remove loading indicator
        function removeLoadingIndicator() {
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) {
                loadingIndicator.remove();
            }
        }

        // Handle form submission
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = userInput.value.trim();
            if (!message) return;

            addMessage('user', message);
            userInput.value = '';
            showLoadingIndicator();

            // Add user message to history
            chatHistory.push({ role: "user", parts: [{ text: message }] });

            try {
                // Call the Gemini API
                const apiKey = "AIzaSyAQzezVKjdXbMElqFTagflkAUU0EhOQagk"; // Leave empty, will be handled by the environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const payload = { contents: chatHistory };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                removeLoadingIndicator();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    const botResponse = result.candidates[0].content.parts[0].text;
                    addMessage('bot', botResponse);
                    // Add bot response to history
                    chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
                } else {
                    addMessage('bot', "I'm sorry, I couldn't generate a response. Please try again.");
                }

            } catch (error) {
                console.error('Error calling Gemini API:', error);
                removeLoadingIndicator();
                addMessage('bot', "I'm having trouble connecting. Please check your connection or try again later.");
            }
        });
    </script>
</body>
</html>

